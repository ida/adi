<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
<body>
<tal:comment tal:replace="nothing">
        <a href="./.." title="Go one level up" tal:content="string:up">
up
        </a>
<a tal:attributes="href context/absolute_url">Re</a>
This is the usual change-state-url:
content_status_modify?workflow_action=
If using wf.comments, we need:
content_status_comment?workflow_action=

The first two lines disable the green edit-bar:</tal:comment>
<metal:block fill-slot="top_slot"
   tal:define="dummy python:request.set('disable_border',1)" />
<metal:main fill-slot="main">
<tal:definator
  tal:define="wftool        python: context.portal_workflow;
              Std           modules/Products.PythonScripts/standard;
              newline_to_br nocall:Std/newline_to_br;
              transis       python: wftool.getTransitionsFor(context);
              status        context/plone_context_state/workflow_state;
              trans_url     string:./content_status_comment?workflow_action=">

  <h2 tal:attributes="class string:header state-${status}">
    <a href="./edit" tal:content="context/Title" tal:attributes="class string:state-${status}">
      Title
    </a>
  </h2><tal:comment tal:replace="nothing">EO .head</tal:comment>

  <div class="head">
    <tal:kondinator tal:condition="python:context.id!='refugio'">
    Is
    <span tal:condition="context/isDependencyOf">
      blocking
      <span tal:content="context/isDependencyOf">
      </span>
      and is
    </span>
    <span tal:content="string:${status}"
          tal:attributes="class string:state-${status}">
      new/active/waiting/blocked/closed
    </span>
    <span tal:condition="python: status == 'blocked'">
      by #<a tal:attributes="href context/getDependsOn" tal:content="context/getDependsOn" />
    </span>
    <span tal:condition="context/getResponsiblePerson"
          tal:define="person context/getResponsiblePerson"
          tal:content="string:and assigned to ${person}">
      Responsible person
    </span>
    <tal:repetator tal:repeat="trans transis">
      <tal:definatus tal:define="id trans/id">
        <a tal:condition="python:id !='block' and id !='start' and id !='pause' and id != 'close'"
           tal:attributes="href string:./content_status_modify?workflow_action=${id};"
           tal:content="id">
any unknown state
        </a>
      </tal:definatus>
    </tal:repetator>
    <tal:repetator tal:repeat="trans transis">
      <tal:definatus tal:define="id trans/id">
        <a tal:condition="python:id=='block'"
           tal:attributes="href string:${trans_url}${id}"
           tal:content="id">
block
        </a>
      </tal:definatus>
    </tal:repetator>
    <tal:repetator tal:repeat="trans transis">
      <tal:definatus tal:define="id trans/id">
        <a tal:condition="python:id=='close'"
           tal:attributes="href string:./content_status_modify?workflow_action=${id}"
           tal:content="id">
close
        </a>
      </tal:definatus>
    </tal:repetator>
    <tal:repetator tal:repeat="trans transis">
      <tal:definatus tal:define="id trans/id">
        <a tal:condition="python:id=='start' or id=='pause'"
           tal:attributes="href string:./content_status_modify?workflow_action=${id}"
           tal:content="id">
          start or pause
        </a>
      </tal:definatus>
    </tal:repetator>


    <a class="add" href="../createObject?type_name=Ticket" title="Add next step">
      +
      <span>
        Add next step
      </span>
    </a>
    </tal:kondinator>
    <a class="add sub" href="./createObject?type_name=Ticket" title="Add substep">
      +
      <span>
        Add substep
      </span>
    </a>

  </div><tal:comment tal:replace="nothing">EO .head</tal:comment>

  <div class="body"
       tal:content="structure python:newline_to_br(context.getText())">
    Text
  </div>

  <ol class="substeps" tal:condition="context/getFolderContents">
      <li tal:repeat="item context/getFolderContents">
        <a tal:define="item_status item/review_state" tal:content="item/Title"
           tal:attributes="href python: context.absolute_url() + '/' + item.id;
                           class string:state-${item_status}">
          Substep title
      </a>
      <div class="body"
           tal:content="structure python:newline_to_br(item.getObject().getText())">
        Substep text
      </div>
    </li>
  </ol>

</tal:definator></metal:main></body></html>
